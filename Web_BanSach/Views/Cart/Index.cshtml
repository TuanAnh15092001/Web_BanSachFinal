@model List<Web_BanSach.Models.GioHang>

@{
    ViewBag.Title = "Giỏ hàng";
    Layout = "~/Views/Shared/_LayoutSach.cshtml";
    <link href="~/Content/Css/Cart.css" rel="stylesheet" />
}

<div class="cart-container">
    @if (Model == null || !Model.Any())
    {
        <!-- ===== GIỎ HÀNG TRỐNG ===== -->
        <div class="empty-cart">
            <div class="empty-cart-icon">
                <i class="fa fa-shopping-cart"></i>
            </div>
            <h3>Giỏ hàng của bạn đang trống!</h3>
            <p>Có vẻ như bạn chưa thêm sản phẩm nào vào giỏ hàng</p>
            <a href="@Url.Action("Index", "Sach")" class="shop-now-btn">
                <i class="fa fa-book"></i>
                Khám phá sách ngay
            </a>
        </div>
    }
    else
    {
        <!-- ===== HEADER ===== -->
        <div class="cart-header">
            <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                <h1 class="cart-title">
                    <i class="fa fa-shopping-cart"></i>
                    Giỏ hàng
                </h1>
                <span class="cart-count">@Model.Count sản phẩm</span>
            </div>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <a href="@Url.Action("Index", "Sach")" class="continue-shopping">
                    <i class="fa fa-arrow-left"></i>
                    Tiếp tục mua sắm
                </a>
            </div>
        </div>

        <!-- ===== NỘI DUNG CHÍNH ===== -->
        <div class="cart-content">
            <!-- DANH SÁCH SẢN PHẨM -->
            <div class="cart-items">
                @foreach (var item in Model)
                {
                    <div class="cart-item">
                        <!-- Ảnh sản phẩm -->
                        <div class="item-image">
                            <img src="~/Content/HinhAnh/@item.AnhBia" alt="@item.TenSach" />
                        </div>

                        <!-- Thông tin sản phẩm -->
                        <div class="item-details">
                            <h3 class="item-name">@item.TenSach</h3>
                            <div class="item-price">@String.Format("{0:#,##0}", item.GiaBan) VNĐ</div>
                            <div class="item-subtotal">
                                Tạm tính: <span>@String.Format("{0:#,##0}", item.ThanhTien) VNĐ</span>
                            </div>
                        </div>

                        <!-- Điều khiển -->
                        <div class="item-actions">
                            <form method="post" action="@Url.Action("CapNhatGio", "Cart")" style="margin: 0;">
                                <input type="hidden" name="masach" value="@item.MaSach" />
                                <div class="quantity-control">
                                    <button type="button" class="qty-btn" onclick="decreaseQty(this)">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                    <input type="number" name="soluong" value="@item.SoLuong" min="1" class="qty-input"
                                           onchange="this.form.submit()" />
                                    <button type="button" class="qty-btn" onclick="increaseQty(this)">
                                        <i class="fa fa-plus"></i>
                                    </button>
                                </div>
                            </form>

                            <a href="@Url.Action("XoaGio", "Cart", new { masach = item.MaSach })"
                               class="remove-btn"
                               onclick="return confirm('Bạn có chắc muốn xóa sản phẩm này?');">
                                <i class="fa fa-trash-alt"></i>
                                Xóa
                            </a>
                        </div>
                    </div>
                }
            </div>

            <!-- SIDEBAR - TỔNG TIỀN -->
            <div class="cart-summary">
                <h2 class="summary-title">
                    <i class="fa fa-receipt"></i>
                    Thông tin đơn hàng
                </h2>

                <div class="summary-row">
                    <span>Số lượng sản phẩm:</span>
                    <span>@Model.Sum(x => x.SoLuong) sản phẩm</span>
                </div>

                <div class="summary-row">
                    <span>Tạm tính:</span>
                    <span>@String.Format("{0:#,##0}", ViewBag.TongTien) VNĐ</span>
                </div>
                <div class="summary-row total">
                    <span class="label">Tổng thanh toán:</span>
                    <span class="value">@String.Format("{0:#,##0}", ViewBag.TongTien) VNĐ</span>
                </div>

                <a href="@Url.Action("Checkout", "DatHang")" class="checkout-btn">
                    <i class="fa fa-credit-card"></i>
                    Tiến hành đặt hàng
                </a>

            </div>
        </div>
    }
</div>

<script>
    // Tăng số lượng
    function increaseQty(btn) {
        var input = btn.parentElement.querySelector('.qty-input');
        input.value = parseInt(input.value) + 1;
        input.form.submit();
    }

    // Giảm số lượng
    function decreaseQty(btn) {
        var input = btn.parentElement.querySelector('.qty-input');
        if (parseInt(input.value) > 1) {
            input.value = parseInt(input.value) - 1;
            input.form.submit();
        }
    }

    // Animation khi xóa sản phẩm
    document.querySelectorAll('.remove-btn').forEach(btn => {
        btn.addEventListener('click', function (e) {
            if (confirm('Bạn có chắc muốn xóa sản phẩm này?')) {
                const item = this.closest('.cart-item');
                item.style.transition = 'all 0.1s ease';
                item.style.opacity = '0';
                item.style.transform = 'translateX(50px)';
            } else {
                e.preventDefault();
            }
        });
    });
</script>