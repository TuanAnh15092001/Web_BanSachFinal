@model Web_BanSach.BANGSACH

@{
    ViewBag.Title = "Chỉnh sửa Sách";
    <link href="~/Areas/Css/SuaSach.css" rel="stylesheet" />
}
<section class="edit-container">
    @using (Html.BeginForm("SuaSach", "SachEdit", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        @Html.AntiForgeryToken()
        @Html.HiddenFor(model => model.MASACH)

        <div class="edit-card">
            <!-- Header -->
            <div class="edit-header">
                <div class="header-left">
                    <div class="header-icon">
                        <i class="fa-solid fa-book-open"></i>
                    </div>
                    <div class="header-content">
                        <h2>Chỉnh sửa Sách</h2>
                        <p>Đang chỉnh sửa: <span class="book-name-badge">@Model.TENSACH</span></p>
                    </div>
                </div>
            </div>

            <!-- Body -->
            <div class="edit-body">
                <!-- Left Sidebar - Image -->
                <div class="edit-sidebar">
                    <!-- Current Image -->
                    <div class="current-book-card">
                        <img src="~/Content/HinhAnh/@Model.ANHBIA" alt="@Model.TENSACH" class="preview-image" />
                        <h4 class="preview-title">Ảnh bìa hiện tại</h4>
                        <p class="preview-price">@Model.ANHBIA</p>
                    </div>

                    <!-- Upload New Image -->
                    <div class="file-upload-card" id="dropZone">
                        <div class="upload-icon">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                        </div>
                        <p class="upload-text">Tải ảnh mới</p>
                        <p class="upload-hint">Kéo thả hoặc click để chọn<br />JPG, PNG (Max 5MB)</p>
                        <input type="file" name="AnhBiaUpload" accept="image/*" class="file-input" id="fileInput" />

                        <div class="file-name-display" id="fileNameDisplay">
                            <i class="fa-solid fa-check-circle"></i>
                            <span id="fileName"></span>
                        </div>
                    </div>
                </div>

                <!-- Right Main - Form -->
                <div class="edit-main">
                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                    <!-- Row 1: Tên sách (full) -->
                    <div class="form-row full-width">
                        <div class="custom-form-group">
                            <label class="custom-label">
                                <i class="fa-solid fa-book"></i>
                                Tên sách
                                <span class="required-star">*</span>
                            </label>
                            @Html.TextBoxFor(model => model.TENSACH, new
                            {
                                @class = "custom-input",
                                placeholder = "Nhập tên sách..."
                            })
                            @Html.ValidationMessageFor(model => model.TENSACH, "", new { @class = "field-validation-error" })
                        </div>
                    </div>

                    <!-- Row 2: Giá bán + Năm xuất bản + Loại + NXB (4 cols) -->
                    <div class="form-row three-cols">
                        <div class="custom-form-group">
                            <label class="custom-label">
                                <i class="fa-solid fa-money-bill-wave"></i>
                                Giá bán (VNĐ)
                                <span class="required-star">*</span>
                            </label>
                            @Html.TextBoxFor(model => model.GIABAN, new
                            {
                                @class = "custom-input",
                                placeholder = "VD: 150000",
                                type = "number",
                                min = "0"
                            })
                            @Html.ValidationMessageFor(model => model.GIABAN, "", new { @class = "field-validation-error" })
                        </div>

                        <div class="custom-form-group">
                            <label class="custom-label">
                                <i class="fa-solid fa-calendar-alt"></i>
                                Năm xuất bản
                                <span class="required-star">*</span>
                            </label>
                            @Html.TextBoxFor(model => model.NAMXUATBAN, new
                            {
                                @class = "custom-input",
                                placeholder = "VD: 2024",
                                type = "number",
                                min = "1900",
                                max = "2100"
                            })
                            @Html.ValidationMessageFor(model => model.NAMXUATBAN, "", new { @class = "field-validation-error" })
                        </div>

                        <div class="custom-form-group">
                            <label class="custom-label">
                                <i class="fa-solid fa-bookmark"></i>
                                Loại sách
                                <span class="required-star">*</span>
                            </label>
                            @Html.DropDownListFor(m => m.MALOAI, (SelectList)ViewBag.SelectLoai, "-- Chọn loại --", new
                            {
                                @class = "custom-select",
                                required = "required"
                            })
                            @Html.ValidationMessageFor(m => m.MALOAI, "", new { @class = "field-validation-error" })
                        </div>

                        <div class="custom-form-group">
                            <label class="custom-label">
                                <i class="fa-solid fa-building"></i>
                                Nhà xuất bản
                                <span class="required-star">*</span>
                            </label>
                            @Html.DropDownListFor(m => m.MANXB, (SelectList)ViewBag.SelectNXB, "-- Chọn NXB --", new
                            {
                                @class = "custom-select",
                                required = "required"
                            })
                            @Html.ValidationMessageFor(m => m.MANXB, "", new { @class = "field-validation-error" })
                        </div>
                    </div>

                    <!-- Divider -->
                    <div class="section-divider">
                        <div class="section-divider-line"></div>
                        <span class="section-divider-text">
                            <i class="fa-solid fa-align-left"></i>
                            Nội dung mô tả
                        </span>
                        <div class="section-divider-line right"></div>
                    </div>

                    <!-- Row 3: Nội dung (full width) -->
                    <div class="form-row full-width">
                        <div class="custom-form-group">
                            <label class="custom-label">
                                <i class="fa-solid fa-file-lines"></i>
                                Nội dung tóm tắt
                            </label>
                            @Html.TextAreaFor(model => model.NOIDUNG, new
                            {
                                @class = "custom-textarea",
                                placeholder = "Nhập nội dung mô tả sách...",
                                rows = "4"
                            })
                            @Html.ValidationMessageFor(model => model.NOIDUNG, "", new { @class = "field-validation-error" })
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="edit-footer">
                <a href="@Url.Action("Index")" class="btn-cancel">
                    <i class="fa-solid fa-arrow-left"></i>
                    Quay lại
                </a>
                <button type="submit" class="btn-save">
                    <i class="fa-solid fa-floppy-disk"></i>
                    Lưu thay đổi
                </button>
            </div>
        </div>
    }
</section>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileNameDisplay = document.getElementById('fileNameDisplay');
        const fileName = document.getElementById('fileName');

        // Click to upload
        dropZone.addEventListener('click', () => fileInput.click());

        // File selected
        fileInput.addEventListener('change', function () {
            if (this.files.length > 0) {
                fileName.textContent = this.files[0].name;
                fileNameDisplay.classList.add('show');
            }
        });

        // Drag and drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');

            if (e.dataTransfer.files.length > 0) {
                fileInput.files = e.dataTransfer.files;
                fileName.textContent = e.dataTransfer.files[0].name;
                fileNameDisplay.classList.add('show');
            }
        });
    });
</script>